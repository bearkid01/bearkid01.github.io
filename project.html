<!DOCTYPE html>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/bootstrap-theme.min.css" rel="stylesheet">

<style type="text/css">

#boroughs {
  stroke: black;
  stroke-width: 1px;
  fill: steelblue;
}

.background {
  fill: none;
  pointer-events: all;
}

/*body {
        padding-top: 10px;
        padding-bottom: 20px;
        width: 900px;
        height: 1000px;
    }
*/
#map {
  position: absolute;
  top: 150px;
  left: 30px;
  height: 600px;
}

#lineChart {    
  position:absolute;
  top:270px;
  left:720px;
  height: 200px;
}

#barChart {    
  position:absolute;
  top:440px;
  left:720px;
  height: 470px;
}

.legend {
  position: absolute;
  top: 150px;
  left: 30px;
}

.axis path, 
.axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
}


.line {
  fill: none;
  stroke-width: 3px;
}

.dot {
  fill: white;
  stroke-width: 1.5px;
  } 

.axis text {
    font-family: Verdana;
    font-size: 11px;
}

.title {
    font-family: Verdana;
    font-size: 15px;  
}

.xAxis {
    fill: none;
    stroke: black;
    stroke-width: 1px;
}  

.yAxis {
    font-family: Verdana;
    font-size: 12px;
    fill: white;
}

.xAxis text {
    font-family: Verdana;
    font-size: 11px;
}

/*div#text{
  width: 300px;
  left: 120px;
  top: 1000px;
  position: absolute;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  }

div#text2{
  width: 300px;
  left: 520px;
  top: 1000px;
  position: absolute;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  }*/

</style>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">MSN 622</a>
        </div>

        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="index.html#homework">Homework</a></li>
                <li><a href="index.html#project">Project</a></li>
                <li><a href="index.html#participation">Participation</a></li>
            </ul>

            <ul class="nav navbar-nav navbar-right">
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>
  
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>

<!-- <div id="div1">
  <h1 align="center">Data Visualization Project</h1>
  <h2 align="center">Project Dashboard</h2>
</div> -->

<div id="map"></div>
<div id="lineChart"></div>
<div id="barChart"></div>


<script>

var margin = {top: 30, right: 20, bottom: 30, left: 0},
    width = 700 - margin.left - margin.right,
    height = 700 - margin.top - margin.bottom,
    centered;

var projection = d3.geo.mercator()
    .center([-73.94, 40.70])
    .scale(50000)
    .translate([width / 2, height / 2]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("#map").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

svg.append("rect")
    .attr("class", "background")
    .attr("width", width)
    .attr("height", height)
    //.on("click", clicked);

// add legend

var sampleCategoricalData = [{"region":"Staten Island","color":"orange"},{"region":"Queens","color":"#636363"},{"region": "Brooklyn", "color":"green"}, { "region":"Manhattan", "color":"purple"}, {"region": "Bronx", "color":"steelblue"}];


  var legend = svg.selectAll(".legend")
    .data(sampleCategoricalData)
    .enter().append("g")
    .attr("class", "legend")
    .attr("transform", function (d, i) {
    return "translate(0," + i * 20 + ")";
    });

    legend.append("circle")
        .attr("cx", width - 580)
        .attr("cy", 75)
        .attr("r", 8)
        .style("fill", function(d){return d.color;})
        .style("fill-opacity", ".85")
        .style("stroke","black")
        .style("stroke-width",1.5);

    legend.append("text")
        .attr("x", width - 480)
        .attr("y", 75)
        .attr("dy", ".35em")
        .style("text-anchor", "end")
        .text(function (d) {
        return d.region;
    });


var g = svg.append("g");

d3.json("nyc.json", function(error, nyb) {

  colorMap = {"Staten Island": "orange", "Queens": "#636363", "Brooklyn": "green", "Manhattan": "purple", "Bronx": "steelblue"}

  shortName = {"Staten Island": "Staten Island", "Queens": "Queens", "Brooklyn": "Brooklyn", "Manhattan": "Manhattan", "Bronx": "Bronx"}

    for (i=0; i<nyb.features.length; i++){
      nyb.features[i]["colors"] = colorMap[nyb.features[i]["properties"]["borough"]]
    }

    for (i=0; i<nyb.features.length; i++){
      nyb.features[i]["shortname"] = shortName[nyb.features[i]["properties"]["borough"]]
    }

  console.log(nyb.features);

  g.append("g")
      .attr("id", "boroughs")
    .selectAll(".state")
      .data(nyb.features)
    .enter().append("path")
    .attr("class", function(d){ return d.properties.boroughCode; })
      .attr("d", path)
      .style("fill", function(d){ return d.colors; })
      .on("click", clicked);

  // g.append("path")
  //     .datum(topojson.mesh(nyb, us.objects.states, function(a, b) { return a !== b; }))
  //     .attr("id", "borough-borders")
  //     .attr("d", path);


  function clicked(d, i) {
  var x, y, k;

  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    k = 3.5;
    centered = d;
  } else {
    x = width / 2;
    y = height / 2;
    k = 1;
    centered = null;
  }

  g.selectAll("path")
      .classed("active", centered && function(d) { return d === centered; });

  g.transition()
      .duration(750)
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
      .style("stroke-width", 1.5 / k + "px");

  
  updateLineChart(nyb.features[i].shortname, nyb.features[i].colors);

  updateBarChart(nyb.features[i].shortname, nyb.features[i].colors);
}

});

//Bar Chart 

var formatAsInteger = d3.format(",");

var datasetLineChart = [
{"group": "All", "year": 2010, "freq": 550},
{"group": "All", "year": 2011, "freq": 545},
{"group": "All", "year": 2012, "freq": 578},
{"group": "All", "year": 2013, "freq": 585},
{"group": "All", "year": 2014, "freq": 580},
{"group": "All", "year": 2015, "freq": 191},
{"group": "Bronx", "year": 2010, "freq": 323},
{"group": "Bronx", "year": 2011, "freq": 314},
{"group": "Bronx", "year": 2012, "freq": 323},
{"group": "Bronx", "year": 2013, "freq": 320},
{"group": "Bronx", "year": 2014, "freq": 337},
{"group": "Bronx", "year": 2015, "freq": 114},
{"group": "Brooklyn", "year": 2010, "freq": 735},
{"group": "Brooklyn", "year": 2011, "freq": 659},
{"group": "Brooklyn", "year": 2012, "freq": 690},
{"group": "Brooklyn", "year": 2013, "freq": 748},
{"group": "Brooklyn", "year": 2014, "freq": 667},
{"group": "Brooklyn", "year": 2015, "freq": 209},
{"group": "Manhattan", "year": 2010, "freq": 978},
{"group": "Manhattan", "year": 2011, "freq": 1046},
{"group": "Manhattan", "year": 2012, "freq": 1165},
{"group": "Manhattan", "year": 2013, "freq": 1119},
{"group": "Manhattan", "year": 2014, "freq": 1194},
{"group": "Manhattan", "year": 2015, "freq": 406},
{"group": "Queens", "year": 2010, "freq": 566},
{"group": "Queens", "year": 2011, "freq": 584},
{"group": "Queens", "year": 2012, "freq": 605},
{"group": "Queens", "year": 2013, "freq": 628},
{"group": "Queens", "year": 2014, "freq": 596},
{"group": "Queens", "year": 2015, "freq": 193},
{"group": "Staten Island", "year": 2010, "freq": 149},
{"group": "Staten Island", "year": 2011, "freq": 123},
{"group": "Staten Island", "year": 2012, "freq": 109},
{"group": "Staten Island", "year": 2013, "freq": 111},
{"group": "Staten Island", "year": 2014, "freq": 110},
{"group": "Staten Island", "year": 2015, "freq": 37}
];

// set initial group value
// set initial category value
var group = "All";

function datasetLineChartChosen(group) {
  var ds = [];
  for (x in datasetLineChart) {
     if(datasetLineChart[x].group==group){
      ds.push(datasetLineChart[x]);
     } 
    }
  return ds;
}

function dsLineChartBasics() {

  var margin = {top: 30, right: 10, bottom: 0, left: 50},
      width =  500- margin.left - margin.right,
      height = 180 - margin.top - margin.bottom
      ;
    
    return {
      margin : margin, 
      width : width, 
      height : height
    }     
    ;
}


function dsLineChart() {

  var firstDatasetLineChart = datasetLineChartChosen(group);    
  
  var basics = dsLineChartBasics();
  
  var margin = basics.margin,
    width = basics.width,
     height = basics.height
    ;


  // var xScale = d3.scale.linear()
  //     .domain([0, firstDatasetLineChart.length-1])
  //     .range([0, width])
  //     ;

  var xScale = d3.scale.ordinal()
    .domain(firstDatasetLineChart.map(function(d) {return d.year;}))
    .rangeRoundBands([0, width], .1);

  var yScale = d3.scale.linear()
      .domain([0, d3.max(firstDatasetLineChart, function(d) { return d.freq; })])
      .range([height, 0])
      ;

  var line = d3.svg.line()
      //.x(function(d) { return xScale(d.category); })
      .x(function(d) { return xScale(d.year); })
      .y(function(d) { return yScale(d.freq); })
      ;
  
  var svg = d3.select("#lineChart").append("svg")
      .datum(firstDatasetLineChart)
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      // create group and move it so that margins are respected (space for axis and title)
      
  var plot = svg
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
      .attr("id", "lineChartPlot")
      ;

    /* descriptive titles as part of plot -- start */
  var dsLength=firstDatasetLineChart.length;

  // plot.append("text")
  //   .text(firstDatasetLineChart[dsLength-1].freq)
  //   .attr("id","lineChartTitle2")
  //   .attr("x",width/2)
  //   .attr("y",height/2) 
  //   ;
  /* descriptive titles -- end */
      
  plot.append("path")
      .attr("class", "line")
      .attr("d", line)  
      // add color
    .attr("stroke", "lightgrey")
      ;
    
  plot.selectAll(".dot")
      .data(firstDatasetLineChart)
       .enter().append("circle")
      .attr("class", "dot")
      //.attr("stroke", function (d) { return d.measure==datasetMeasureMin ? "red" : (d.measure==datasetMeasureMax ? "green" : "steelblue") } )
      .attr("fill", function (d) { return d.freq==d3.min(firstDatasetLineChart, function(d) { return d.freq; }) ? "red" : (d.freq==d3.max(firstDatasetLineChart, function(d) { return d.freq; }) ? "green" : "white") } )
      //.attr("stroke-width", function (d) { return d.measure==datasetMeasureMin || d.measure==datasetMeasureMax ? "3px" : "1.5px"} )
      .attr("cx", line.x())
      .attr("cy", line.y())
      .attr("r", 3.5)
      .attr("stroke", "lightgrey")
      .append("title")
      //add tooltips here 
      .text(function(d) { return d.year + ": " + formatAsInteger(d.freq); })
      ;

  svg.append("text")
    .text("The Number of Complaints Between 2010 - 2015 On Average")
    .attr("id","lineChartTitle1") 
    .attr("x",margin.left/4 + ((width/2 + margin.right)/4))
    .attr("y", 12)
    ;

}

dsLineChart();


 /* ** UPDATE CHART ** */
 
/* updates bar chart on request */
function updateLineChart(group, colorChosen) {

  var currentDatasetLineChart = datasetLineChartChosen(group); 

  var basics = dsLineChartBasics();
  
  var margin = basics.margin,
    width = basics.width,
     height = basics.height
    ;

  var xScale = d3.scale.linear()
      .domain([0, currentDatasetLineChart.length-1])
      .range([0, width])
      ;

  var yScale = d3.scale.linear()
      .domain([0, d3.max(currentDatasetLineChart, function(d) { return d.freq; })])
      .range([height, 0])
      ;
  
  var line = d3.svg.line()
    .x(function(d, i) { return xScale(i); })
    .y(function(d) { return yScale(d.freq); })
    ;

  var svg = d3.select("#lineChart svg");

   var plot = d3.select("#lineChartPlot")
    .datum(currentDatasetLineChart)
     ;
     
  /* descriptive titles as part of plot -- start */
  var dsLength=currentDatasetLineChart.length;
  
  // plot.select("text")
  //   .text(currentDatasetLineChart[dsLength-1].freq)
  //   ;
  /* descriptive titles -- end */
     
  plot
  .select("path")
    .transition()
    .duration(750)          
     .attr("class", "line")
     .attr("d", line) 
    .attr("stroke", colorChosen)
     ;
     
  var path = plot
    .selectAll(".dot")
     .data(currentDatasetLineChart)
     .transition()
    .duration(750)
     .attr("class", "dot")
     .attr("fill", function (d) { return d.freq==d3.min(currentDatasetLineChart, function(d) { return d.freq; }) ? "red" : (d.freq==d3.max(currentDatasetLineChart, function(d) { return d.freq; }) ? "green" : "white") } )
     .attr("cx", line.x())
     .attr("cy", line.y())
     .attr("r", 4)
    .attr("stroke", colorChosen)
     ;
     
     console.log(currentDatasetLineChart);

  var addpath = path
     .select("title")
     .text(function(d) { return d.year + ": " + formatAsInteger(d.freq); })   
     ;  

  //here is the problem... 

  svg.selectAll("text") // target the text element(s) which has a title class defined
      .attr("x", (width + margin.left + margin.right)/2)
      .attr("y", 15)
      .attr("class","title")        
      .attr("text-anchor", "middle")
      .text(group + "'s Complaints Between 2010 - 2015")
    ;
}

//Bar Plot 

var datasetBarChart = [
{"group": "All", "Loc": "Cafeteria - Schools", "freq": 18},
{"group": "All", "Loc": "Food Cart Vendor", "freq": 134},
{"group": "All", "Loc": "Restaurant /Bar /Deli /Bakery", "freq": 2414},
{"group": "All", "Loc": "Others", "freq": 471},
{"group": "Bronx", "Loc": "Cafeteria - Schools", "freq": 15},
{"group": "Bronx", "Loc": "Food Cart Vendor", "freq": 63},
{"group": "Bronx", "Loc": "Restaurant /Bar /Deli /Bakery", "freq": 1293},
{"group": "Bronx", "Loc": "Others", "freq": 360},
{"group": "Brooklyn", "Loc": "Cafeteria - Schools", "freq": 23},
{"group": "Brooklyn", "Loc": "Food Cart Vendor", "freq": 131},
{"group": "Brooklyn", "Loc": "Restaurant /Bar /Deli /Bakery", "freq": 2918},
{"group": "Brooklyn", "Loc": "Others", "freq": 636},
{"group": "Manhattan", "Loc": "Cafeteria - Schools", "freq": 27},
{"group": "Manhattan", "Loc": "Food Cart Vendor", "freq": 329},
{"group": "Manhattan", "Loc": "Restaurant /Bar /Deli /Bakery", "freq": 4872},
{"group": "Manhattan", "Loc": "Others", "freq": 680},
{"group": "Queens", "Loc": "Cafeteria - Schools", "freq": 24},
{"group": "Queens", "Loc": "Food Cart Vendor", "freq": 129},
{"group": "Queens", "Loc": "Restaurant /Bar /Deli /Bakery", "freq": 2468},
{"group": "Queens", "Loc": "Others", "freq": 551},
{"group": "Staten Island", "Loc": "Cafeteria - Schools", "freq": 4},
{"group": "Staten Island", "Loc": "Food Cart Vendor", "freq": 19},
{"group": "Staten Island", "Loc": "Restaurant /Bar /Deli /Bakery", "freq": 520},
{"group": "Staten Island", "Loc": "Others", "freq": 96}
];

// set initial group value
var group = "All";

function datasetBarChosen(group) {
  var ds = [];
  for (x in datasetBarChart) {
     if(datasetBarChart[x].group==group){
      ds.push(datasetBarChart[x]);
     } 
    }
  return ds;
}


function dsBarChartBasics() {

    var margin = {top: 50, right: 5, bottom: 50, left: 50},
    width = 500 - margin.left - margin.right,
     height = 250 - margin.top - margin.bottom,
    colorBar = d3.scale.category20(),
    barPadding = 1
    ;
    
    return {
      margin : margin, 
      width : width, 
      height : height, 
      colorBar : colorBar, 
      barPadding : barPadding
    }     
    ;
}

function dsBarChart() {

  var firstDatasetBarChart = datasetBarChosen(group);   

  console.log(firstDatasetBarChart);        
  
  var basics = dsBarChartBasics();
  
  var margin = basics.margin,
    width = basics.width,
     height = basics.height,
    colorBar = basics.colorBar,
    barPadding = basics.barPadding
    ;
          
  var xScale = d3.scale.ordinal()
            //.domain([0, firstDatasetBarChart.length])
            .rangeRoundBands([0, width], 0.05)
            ;
            
  var xAxis = d3.svg.axis()
    .scale(xScale)
    .orient("bottom");

  xScale.domain(firstDatasetBarChart.map(function(d) { return d.Loc; }));

  // Create linear y scale 
  // Purpose: No matter what the data is, the bar should fit into the svg area; bars should not
  // get higher than the svg height. Hence incoming data needs to be scaled to fit into the svg area.  
  var yScale = d3.scale.linear()
      // use the max funtion to derive end point of the domain (max value of the dataset)
      // do not use the min value of the dataset as min of the domain as otherwise you will not see the first bar
       .domain([0, d3.max(firstDatasetBarChart, function(d) { return d.freq; })])
       // As coordinates are always defined from the top left corner, the y position of the bar
       // is the svg height minus the data value. So you basically draw the bar starting from the top. 
       // To have the y position calculated by the range function
       .range([height, 0])
       ;
  
  //Create SVG element
  
  var svg = d3.select("#barChart")
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .attr("id","barChartPlot")
        ;
  
  var plot = svg
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        ;
              
  // plot.selectAll("rect")
  //      .data(firstDatasetBarChart)
  //      .enter()
  //      .append("rect")
  //     .attr("x", function(d, i) {
  //         return xScale(i);
  //     })
  //      .attr("width", width / firstDatasetBarChart.length - barPadding)   
  //     .attr("y", function(d) {
  //         return yScale(d.freq);
  //     })  
  //     .attr("height", function(d) {
  //         return height-yScale(d.freq);
  //     })
  //     .attr("fill", "lightgrey")
  //     ;

    plot.selectAll("rect")
       .data(firstDatasetBarChart)
       .enter()
       .append("rect")
      .attr("x", function(d) {
          return xScale(d.Loc);
      })
       .attr("width", width / firstDatasetBarChart.length - barPadding)   
      .attr("y", function(d) {
          return yScale(d.freq);
      })  
      .attr("height", function(d) {
          return height-yScale(d.freq);
      })
      .attr("fill", "lightgrey")
      ;
  
    
  // Add y labels to plot 
  
  plot.selectAll("text")
  .data(firstDatasetBarChart)
  .enter()
  .append("text")
  .text(function(d) {
      return formatAsInteger(d3.round(d.freq));
  })
  .attr("text-anchor", "middle")
  // Set x position to the left edge of each bar plus half the bar width
  .attr("x", function(d, i) {
      return (i * (width / firstDatasetBarChart.length)) + ((width / firstDatasetBarChart.length - barPadding) / 2);
  })
  .attr("y", function(d) {
      return yScale(d.freq) + 14;
  })
  .attr("class", "yAxis")
  ;
  
  // Add x labels to chart  
  
  var xLabels = svg
        .append("g")
        .attr("class", "xAxis")
        .attr("transform", "translate(" + margin.left + "," + (margin.top + height)  + ")")
        .call(xAxis)

      // .selectAll(".tick text")
      //   .call(wrap, x.rangeBand())
        ;
  
  xLabels.selectAll("text")
      .data(firstDatasetBarChart)
      .enter()
      .append("text")
      .text(function(d) { return d.Loc;})
      // .attr("dx", "-.8em")
      // .attr("dy", "-.55em")
      // .attr("transform", "rotate(-90)" )
      .attr("text-anchor", "end")
      // Set x position to the left edge of each bar plus half the bar width
               .attr("x", function(d, i) {
                  return (i * (width / firstDatasetBarChart.length)) + ((width / firstDatasetBarChart.length - barPadding) / 2);
               })
      .attr("y", 20)
      ;
        
   
  // Title
  
  svg.append("text")
    .attr("x", (width + margin.left + margin.right)/2)
    .attr("y", 15)
    .attr("class","title")        
    .attr("text-anchor", "middle")
    .text("Location Type Breakdown On Average")
    ;
}

dsBarChart();

 /* ** UPDATE CHART ** */
 
/* updates bar chart on request */

function updateBarChart(group, colorChosen) {
  
    var currentDatasetBarChart = datasetBarChosen(group);
    
    var basics = dsBarChartBasics();
  
    var margin = basics.margin,
      width = basics.width,
       height = basics.height,
      colorBar = basics.colorBar,
      barPadding = basics.barPadding
      ;
    
    var xScale = d3.scale.linear()
      .domain([0, currentDatasetBarChart.length])
      .range([0, width])
      ;
    
      
    var yScale = d3.scale.linear()
        .domain([0, d3.max(currentDatasetBarChart, function(d) { return d.freq; })])
        .range([height,0])
        ;
        
     var svg = d3.select("#barChart svg");
        
     var plot = d3.select("#barChartPlot")
      .datum(currentDatasetBarChart)
       ;
  
        /* Note that here we only have to select the elements - no more appending! */
      plot.selectAll("rect")
        .data(currentDatasetBarChart)
        .transition()
      .duration(750)
      .attr("x", function(d, i) {
          return xScale(i);
      })
       .attr("width", width / currentDatasetBarChart.length - barPadding)   
      .attr("y", function(d) {
          return yScale(d.freq);
      })  
      .attr("height", function(d) {
          return height-yScale(d.freq);
      })
      .attr("fill", colorChosen)
      ;
    
    plot.selectAll("text.yAxis") // target the text element(s) which has a yAxis class defined
      .data(currentDatasetBarChart)
      .transition()
      .duration(750)
       .attr("text-anchor", "middle")
       .attr("x", function(d, i) {
          return (i * (width / currentDatasetBarChart.length)) + ((width / currentDatasetBarChart.length - barPadding) / 2);
       })
       .attr("y", function(d) {
          return yScale(d.freq) + 14;
       })
       .text(function(d) {
        return formatAsInteger(d3.round(d.freq));
       })
       .attr("class", "yAxis")           
    ;
  
    svg.selectAll("text.title") // target the text element(s) which has a title class defined
      .attr("x", (width + margin.left + margin.right)/2)
      .attr("y", 15)
      .attr("class","title")        
      .attr("text-anchor", "middle")
      .text(group + "'s Location Type Breakdown")
    ;
}


function wrap(text, width) {
  text.each(function() {
    var text = d3.select(this),
        words = text.text().split(/\s+/).reverse(),
        word,
        line = [],
        lineNumber = 0,
        lineHeight = 1.1, // ems
        y = text.attr("y"),
        dy = parseFloat(text.attr("dy")),
        tspan = text.text(null).append("tspan").attr("x", 0).attr("y", y).attr("dy", dy + "em");
    while (word = words.pop()) {
      line.push(word);
      tspan.text(line.join(" "));
      if (tspan.node().getComputedTextLength() > width) {
        line.pop();
        tspan.text(line.join(" "));
        line = [word];
        tspan = text.append("tspan").attr("x", 0).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
      }
    }
  });
}

  d3.select("#barChart").selectAll(".tick text").call(wrap, 100)

</script>
</body>
</html>
